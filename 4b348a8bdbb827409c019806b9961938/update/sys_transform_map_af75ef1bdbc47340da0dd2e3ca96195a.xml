<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_transform_map">
    <sys_transform_map action="INSERT_OR_UPDATE">
        <active>true</active>
        <copy_empty_fields>false</copy_empty_fields>
        <create_new_record_on_empty_coalesce_fields>false</create_new_record_on_empty_coalesce_fields>
        <enforce_mandatory_fields>Only Mapped Fields</enforce_mandatory_fields>
        <name>OpsRamp CI Trans Map</name>
        <order>100</order>
        <run_business_rules>true</run_business_rules>
        <run_script>true</run_script>
        <script><![CDATA[(function transformRow(source, target, map, log, isUpdate) {
	//log.info("[" + map.name + "] - Is Update?: " + isUpdate + " - Resource Type: " + source.u_resourcetype);
	
	//Map OpsRamp resource type to SNOW class
	if(!source.resource_type.nil()) {
		if(source.resource_type == 'Linux') {
			target.sys_class_name = 'cmdb_ci_linux_server';
		} else if(source.resource_type == 'Load balancer') {
			target.sys_class_name = 'cmdb_ci_cloud_load_balancer';
		} else { // Default creating with 'cmdb_ci_linux_server'
			log.warn("[" + map.name + "] -  No mapping found for resource_type: " + source.resource_type + ". Hence mapping to default class as: 'cmdb_ci_linux_server'");
			target.sys_class_name = 'cmdb_ci_linux_server';
		}
	}
	
	//Map company in case it is Partner level integration
	if(!source.opsramp_tenant_id.nil()) {
		var comp = new GlideRecordSecure('core_company');
		comp.addQuery("x_opra_opsramp_int_opsramp_client_id", source.opsramp_tenant_id);
		comp.query();
		if(comp.next()) {
			//log.warn("[" + map.name + "] - company sys Id mapped to client id " + source.opsramp_tenant_id + " is : " + comp.sys_id);
			target.company = comp.sys_id;
		} else {
			log.error("[" + map.name + "] - No company mapping found for opsramp_tenant_id: " + source.opsramp_tenant_id + ".");
			//target.company = "86c1f3193790200044e0bfc8bcbe5d95"; //ACME Africa
		}
	}

})(source, target, map, log, action==="update");]]></script>
        <source_table>x_opra_opsramp_int_opsramp_ci</source_table>
        <sys_class_name>sys_transform_map</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2019-03-13 09:54:31</sys_created_on>
        <sys_customer_update>false</sys_customer_update>
        <sys_id>af75ef1bdbc47340da0dd2e3ca96195a</sys_id>
        <sys_mod_count>3</sys_mod_count>
        <sys_name>OpsRamp CI Trans Map</sys_name>
        <sys_package display_value="OpsRamp Integration" source="x_opra_opsramp_int">4b348a8bdbb827409c019806b9961938</sys_package>
        <sys_policy/>
        <sys_replace_on_upgrade>false</sys_replace_on_upgrade>
        <sys_scope display_value="OpsRamp Integration">4b348a8bdbb827409c019806b9961938</sys_scope>
        <sys_update_name>sys_transform_map_af75ef1bdbc47340da0dd2e3ca96195a</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2021-09-06 16:22:38</sys_updated_on>
        <target_table>cmdb_ci</target_table>
    </sys_transform_map>
</record_update>
